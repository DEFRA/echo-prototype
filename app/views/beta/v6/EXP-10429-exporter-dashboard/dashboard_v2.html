{% extends "layout.html" %}
{% block pageTitle %}
GOV.UK Prototype Kit
{% endblock %}
{% block beforeContent %}
<div class="login-nav login-border">
  <ul class="login-nav__list">
    <li class="login-nav__list-item" id="Nav-DisplayName">Ann Cooper</li>
    <li class="login-nav__list-item"> | <a href="https://identity-management-app.herokuapp.com/manage/team-members/services-on-team-member-admin-account_company-exports?serviceLine=Exporter%20Service&serviceRole=Exporter&numUsers=1&numAgents=0&numServices=1&multiOrg=no&parentChild=parent"
        class="govuk-link login-nav__link govuk-link--no-visited-state profile" id="Link-ManageAccount">Manage account</a>|</li>
    <li class="login-nav__list-item"><a href="#ß" class="govuk-link login-nav__link govuk-link--no-visited-state" id="Link-SignOut">Sign out</a></li>
  </ul>
</div>
{% endblock%}
{% block content %}
<style>
  main{padding-top: 0px!important;}
    .green-tag{background: #00823b}
</style>

<style>
  #filter-cert-org #filter-container {
        bottom: 0px;
        color: rgb(255, 255, 255);
        height: 40px;
        left: 0px;
        position: relative;
        right: 0px;
        text-decoration: none solid rgb(255, 255, 255);
        text-size-adjust: 100%;
        top: 0px;
        width: 300px;
        column-rule-color: rgb(255, 255, 255);
        perspective-origin: 150px 20px;
        transform-origin: 150px 20px;
        caret-color: rgb(255, 255, 255);
        background: rgb(0, 94, 165) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 36 36' width='40' height='40'%3E%3Cpath d='M25.7 24.8L21.9 21c.7-1 1.1-2.2 1.1-3.5 0-3.6-2.9-6.5-6.5-6.5S10 13.9 10 17.5s2.9 6.5 6.5 6.5c1.6 0 3-.6 4.1-1.5l3.7 3.7 1.4-1.4zM12 17.5c0-2.5 2-4.5 4.5-4.5s4.5 2 4.5 4.5-2 4.5-4.5 4.5-4.5-2-4.5-4.5z' fill='white'%3E%3C/path%3E%3C/svg%3E") no-repeat scroll 0% 0% / 40px 40px padding-box border-box;
        border: 0px none rgb(255, 255, 255);
        font: normal normal 400 normal 16px / normal "Times New Roman";
        outline: rgb(255, 255, 255) none 0px;
    }/*#filter-container*/
    #filter-cert-org #filter-container:after {
        color: rgb(255, 255, 255);
        text-decoration: none solid rgb(255, 255, 255);
        text-size-adjust: 100%;
        column-rule-color: rgb(255, 255, 255);
        caret-color: rgb(255, 255, 255);
        border: 0px none rgb(255, 255, 255);
        font: normal normal 400 normal 16px / normal "Times New Roman";
        outline: rgb(255, 255, 255) none 0px;
    }/*#DIV_4:after*/
    #filter-cert-org #filter-container:before {
        color: rgb(255, 255, 255);
        text-decoration: none solid rgb(255, 255, 255);
        text-size-adjust: 100%;
        column-rule-color: rgb(255, 255, 255);
        caret-color: rgb(255, 255, 255);
        border: 0px none rgb(255, 255, 255);
        font: normal normal 400 normal 16px / normal "Times New Roman";
        outline: rgb(255, 255, 255) none 0px;
    }/*#DIV_4:before*/
    #filter-cert-org #filter-input {
        bottom: 0px;
        height: 22px;
        left: 0px;
        position: relative;
        right: 0px;
        text-size-adjust: 100%;
        top: 0px;
        width: 260px;
        perspective-origin: 130px 20px;
        transform-origin: 130px 20px;
        border: 2px solid rgb(255, 255, 255);
        font: normal normal 400 normal 19px / 25px nta, Arial, sans-serif;
        margin: 0px 0px 0px 40px;
        padding: 9px 10px 5px;
        border: solid 2px #000;
        outline: none;
    }/*#filter-input*/
    #filter-cert-org #filter-input:focus {
        border: solid 2px #ffbf47;
        outline: none;
    }/*#filter-input*/
    #filter-cert-org #filter-input:after {
        text-size-adjust: 100%;
        font: normal normal 400 normal 19px / 25px nta, Arial, sans-serif;
    }/*#filter-input:after*/
    #filter-cert-org #filter-input:before {
        text-size-adjust: 100%;
        font: normal normal 400 normal 19px / 25px nta, Arial, sans-serif;
    }/*#filter-input:before*/
    .govuk-details__summary:before{display: none}
</style>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <h1 class="govuk-heading-xl">Your applications</h1>
    <a class="govuk-heading-m" href="select-certificate">Start a new application</a>
  </div>
</div>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <div class="derfa-filter--content">
      <h2 class="govuk-heading-m">Filter applications</h2>
      <form method="get">
        <div class="govuk-grid-row">
          <div class="govuk-grid-column-one-third">

            <div class="govuk-form-group">
              <label class="govuk-label" for="event-name">
                Keyword search
              </label>
              <input class="govuk-input" id="event-name" name="event-name" type="text">
            </div>
          </div>
          <div class="govuk-grid-column-one-third">
            <div class="govuk-form-group">
              <fieldset class="govuk-fieldset">
                <div class="govuk-form-group">
                  <label class="govuk-label" for="sort">
                    Filter by status
                  </label>
                  <select class="govuk-select" id="sort" name="filter_status">
                    <option value="dispatched">Dispatched</option>
                    <option value="updated" selected>Draft</option>
                    <option value="views">Certifier Action</option>
                    <option value="comments">APHA processing</option>
                    <option value="comments">Completed</option>
                    <option value="comments">Cancelled</option>
                    <option value="comments">Rejected</option>
                  </select>
                </div>
              </fieldset>
            </div>
          </div>
          <div class="govuk-grid-column-one-third ">

          </div>
          <div class="govuk-grid-column-full">
            <button type="submit" class="govuk-button govuk-!-margin-bottom-0" data-module="govuk-button" name="has_filter" value="yes">
              Apply filter
            </button>
            {% if data.has_filter %}
            <a href="dashboard?filter_status=&has_filter=" class="defra-link-button defra-link-button--inline" data-module="govuk-button">
              Clear filters
            </a>
            {% endif %}
          </div>
        </div>
      </form>
    </div>
  </div>
  <div class="govuk-grid-column-full">
    {% if data.has_filter == "yes" or query.search %}
    <div class="filter-tag--wrapper govuk-!-margin-bottom-6" data-module="track-click">
      <p class="govuk-body govuk-!-margin-bottom-2">
        Showing <span id="js-case-count"></span> applications {% if query.search %} matching <strong>‘{{query.search}}’</strong>{% endif %}
        {% if data.has_filter == "yes"%}
        with status {% for filter in data.filter_status %}
        <strong>{{filter | capitalize}}</strong>{%if (data.filter_status|length)-1 == (loop.index) and (data.filter_status|length) != 1 %} or {% elseif (data.filter_status|length) != (loop.index)%},{%endif%}
        {%endfor%}
        {% endif %}
        <!-- {% if data.date_range and data.date_range != "any"%} exporting within <strong>{{data.date_range}}</strong>{% endif %} -->
      </p>
      <p class="govuk-body">
        <a href="dashboard?filter_status=&has_filter=" class="govuk-link govuk-link--no-visited-state govuk-!-font-size-19" data-module="govuk-button">
          Clear
          {% if data.filter_status and query.search %}
          search and filter
          {% elseif data.filter_status %}
          filter
          {% else %}
          search
          {% endif %}
        </a>
      </p>
      <!-- {% for filter in data.filter_status %}
        <div class="filter-tag">
          <p class="filter-tag--text">{{filter | capitalize}}</p> <button type="button" class="filter-tag--remove" aria-label="Remove filter australia" data-module="remove-filter-link" data-track-label="australia" data-facet="keywords" data-value="australia"
            data-name="keywords">✕</button>
        </div>
        {% endfor %} -->

    </div>
    {% endif %}

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
        <table class="govuk-table">
          <thead class="govuk-table__head">
            <tr class="govuk-table__row">
              <th class="govuk-table__header">
                <div class="applicationRef-column">Application</div>
              </th>
              <th class="govuk-table__header">Reference</th>
              <th class="govuk-table__header">Destination</th>
              <th class="govuk-table__header">Submitted date</th>
              <th class="govuk-table__header">Status</th>
            </tr>
          </thead>
          <tbody>

            {% for app in data.applications %}

            {%
            if (not query.search and data.has_filter != "yes")
            or (query.search and (query.search|upper) in (app.applicationID|upper))
            or (query.search and (query.search|upper) in (app.destination|upper))
            or (query.search and (query.search|upper) in (app.reference|upper))
            or (query.search and (query.search|upper) in (app.certificate|upper))
            or app.status in data.filter_status
            %}
            <tr class="govuk-table__row result">
              <th id="1721147986456-appRef" class="b govuk-table__cell applicationRef-column" scope="row">
                <a href="application?reference_num=AUS03402342-KXC&application_id=100065956486&application_status=completed&is_pending_replacement=yes" class="govuk-link govuk-link--no-visited-state">{{app.applicationID}}</a>
              </th>
              <td id="1721147986456-group-number" class="govuk-table__cell" scope="row">
                {{app.reference}}
              </td>
              <td id="1721147986456-submitted" class="govuk-table__cell submitted-column" scope="row">
                {{app.destination}}
              </td>
              <td id="1721147986456-submitted" class="govuk-table__cell submitted-column" scope="row">
                {{app.date}}
              </td>
              <td id="1721147986456-status" class="govuk-table__cell" scope="row">
                <div class="status-tag status-tag--{{app.status | lower}}">
                  {{app.status}}
                </div>
              </td>
            </tr>
            {% endif %}
            {% endfor %}

          </tbody>
        </table>
        <div class="app-example-page">
          <nav class="app-pagination" id="pagination-label">
            <p class="govuk-visually-hidden" aria-labelledby="pagination-label">Pagination navigation</p>
            <ul class="app-pagination__list">
              <li class="app-pagination__item  app-pagination__item--prev">
                <a class="app-pagination__link" href="">Previous<span class="govuk-visually-hidden"> set of pages</span></a>
              </li>
              <li class="app-pagination__item app-pagination__item--active"><a class="app-pagination__link" href="#" style="color: black!important;font-weight: 700">1</a></li>
              <li class="app-pagination__item"><a class="app-pagination__link" href="#">2</a></li>
              <li class="app-pagination__item"><a class="app-pagination__link" href="#">3</a></li>
              <li class="app-pagination__item  app-pagination__item--next">
                <a class="app-pagination__link" href="">Next<span class="govuk-visually-hidden"> set of pages</span></a>
              </li>
            </ul>
            <p class="app-pagination__results">Showing <b>1</b> to <b>30</b> of <b>90</b> results</p>
          </nav>
        </div>
      </div>
    </div>
  </div>
  <script>
    window.addEventListener('load', function() {
      $(".clear-search-holder").hide()
      $(".search-what-cont").hide()
      $("#search").click(function(e) {
        $(".search-what-text").text($("#search-input").val());
        $(".search-what-cont").show();
        $(".result").each(function(e) {
          var text = $(this).text().toLowerCase();
          if (text.indexOf($("#search-input").val().toLowerCase()) > -1) {
            $(this).show();
          } else {
            $(this).hide();
          }
        });
      });
      $("#clear-search, .search-what-close").click(function(e) {
        $(".clear-search-holder").show()
        $(".search-what-text").text($("#search-input").val());
        $(".search-what-cont").show()
        clear - search - holder
        $(".search-what-cont").hide();
        $("#search-input").val("");
        $(".result").each(function(e) {
          $(this).show();
        });
        $(this).blur();
      });
    });
  </script>
  <script type="text/javascript">
    window.addEventListener('load', function() {
      var count = $('.govuk-table__row').length - 1
      // show hide content
      $('.derfa-filter--content').show()
      $('.defra-filter--action').show()
      $('#js-case-count').text(count);
      if (count == 0) {
        $('.govuk-table').hide()
      }
      $('.derfa-filter--content').show()
      $('#defra-filter--button').on("click", function() {
        if (!$('.defra-filter--action').hasClass('defra-filter--open')) {
          $('.derfa-filter--content').show().focus()
          $('.defra-filter--action').addClass('defra-filter--open')
          $('#defra-filter--button').attr('aria-expanded', 'true');
          $(".defra-filter--button-content").text('Hide filters')

        } else {
          $('.derfa-filter--content').hide()
          $('.defra-filter--action').removeClass('defra-filter--open')
          $('#defra-filter--button').attr('aria-expanded', 'false');
          $(".defra-filter--button-content").text('Show filters')
        }
      })
    })
  </script>
  {% endblock %}
